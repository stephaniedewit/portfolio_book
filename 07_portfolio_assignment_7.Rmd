# Portfolio assignment 7: Relational databases

```{r setup xx, include=FALSE}
knitr::opts_chunk$set(warning=FALSE,message=FALSE)

#install.packages("dslabs")

library(tidyverse)
library(dslabs) #package met gapminder dataset
```


```{r flu, dengue en gapminder data inlezen}
gapminder_df <- as.data.frame(gapminder)

gapminder_df

flu_df <- as.data.frame(read.csv(here::here(
  "flu_data.csv"), skip = 11))

flu_df

dengue_df <- as.data.frame(read.csv(here::here(
  "dengue_data.csv"), skip = 11))

dengue_df
```

```{r dataframes tidy maken}
flu_df <- pivot_longer(data = flu_df, cols=c(2:30), names_to = "Country", values_to = "Influenza_activity")

dengue_df <- pivot_longer(data = dengue_df, cols=c(2:11), names_to = "Country", values_to = "Dengue_activity")

#gapminder was al tidy
```

Country in flu en dengue is met een hoofdletter C en type character. Country in gapminder is met een kleine letter c en type factor.
Date als character in flu en dengue, year in gapminder als integer.

```{r kolommen met land en jaartal hetzelfde maken voor de drie dataframes}
#...
flu_df <- separate(data = flu_df, col = Date, into = c("Year", "Month", "Day"), sep = "-")
dengue_df <- separate(data = dengue_df, col = Date, into = c("Year", "Month", "Day"), sep = "-")

#...
flu_df$Country <- as.factor(flu_df$Country)
dengue_df$Country <- as.factor(dengue_df$Country)

flu_df$Year <- as.integer(flu_df$Year)
dengue_df$Year <- as.integer(dengue_df$Year)

#Alle drie dezelfde kolomnamen:
gapminder_df <- rename(gapminder_df, Year = year)
gapminder_df <- rename(gapminder_df, Country = country)

#...
## via https://stackoverflow.com/questions/25089665/error-only-defined-on-a-data-frame-with-all-numeric-variables-with-ddply-on-lar
flu_df <- flu_df %>% group_by(Country, Year) %>% summarise_each(funs(sum),Influenza_activity)

dengue_df <- dengue_df %>% group_by(Country, Year) %>% summarise_each(funs(sum),Dengue_activity)

#Maak er opnieuw dataframes van:
flu_df <- as.data.frame(flu_df)
dengue_df <- as.data.frame(dengue_df)

#Schrijf de drie dataframes om naar .csv en .rds:
write.csv(gapminder_df, file = "gapminder_df.csv")
write.csv(flu_df, file = "flu_df.csv")
write.csv(dengue_df, file = "dengue_df.csv")

saveRDS(gapminder_df, "C:/Users/steph/DSFB2/portfolio_book/gapminder_df.rds")
saveRDS(flu_df, "C:/Users/steph/DSFB2/portfolio_book/flu_df.rds")
saveRDS(dengue_df, "C:/Users/steph/DSFB2/portfolio_book/dengue_df.rds")
```

```{r van RStudio naar DBeaver}
library(DBI)

```

